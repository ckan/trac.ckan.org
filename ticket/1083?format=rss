<?xml version="1.0"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0">
  <channel>
    <title>CKAN: Ticket #1083: userobjectroles added twice can't be deleted</title>
    <link>http://localhost/ticket/1083</link>
    <description>&lt;p&gt;
the add_user_to_role/remove_user_from_role functions are asymmetrical
in that the add function is happy to add the same role twice but the remove asserts that it's only in the table once and crashes if that's not true.
&lt;/p&gt;
&lt;p&gt;
an attempt has been made to guard against this, but fails, I think because the add functions rely on the caller committing the change to the db.
&lt;/p&gt;
&lt;p&gt;
same problem affects corresponding authorization_group functions
&lt;/p&gt;
&lt;p&gt;
I'll try to sort this out. Making a note here.
&lt;/p&gt;
</description>
    <language>en-us</language>
    <image>
      <title>CKAN</title>
      <url>http://assets.okfn.org/p/ckan/img/ckan_logo_shortname.png</url>
      <link>http://localhost/ticket/1083</link>
    </image>
    <generator>Trac 0.12.3</generator>
    <item>
      
        <dc:creator>johnlawrenceaspden</dc:creator>

      <pubDate>Mon, 11 Apr 2011 19:37:56 GMT</pubDate>
      <title>status changed; owner set</title>
      <link>http://localhost/ticket/1083#comment:1</link>
      <guid isPermaLink="false">http://localhost/ticket/1083#comment:1</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;owner&lt;/strong&gt;
              set to &lt;em&gt;johnlawrenceaspden&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;new&lt;/em&gt; to &lt;em&gt;assigned&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>johnlawrenceaspden</dc:creator>

      <pubDate>Mon, 09 May 2011 09:50:43 GMT</pubDate>
      <title>state, milestone set</title>
      <link>http://localhost/ticket/1083#comment:2</link>
      <guid isPermaLink="false">http://localhost/ticket/1083#comment:2</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;state&lt;/strong&gt;
                set to &lt;em&gt;draft&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;milestone&lt;/strong&gt;
                set to &lt;em&gt;ckan-v1.5-sprint-1&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>johnlawrenceaspden</dc:creator>

      <pubDate>Mon, 09 May 2011 21:14:41 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/1083#comment:3</link>
      <guid isPermaLink="false">http://localhost/ticket/1083#comment:3</guid>
      <description>
        &lt;p&gt;
Current behaviour:
&lt;/p&gt;
&lt;p&gt;
from the web interface, russianfan can be added as an admin on warandpeace twice.
and you can then delete the two roles separately.
desired behaviour is that you can only add him once.
&lt;/p&gt;
&lt;p&gt;
from the command line, you can only add him once, but if he's in there twice, you can't remove him because the command line bombs
desired behaviour is that he can be removed
&lt;/p&gt;
&lt;p&gt;
from the shell, you can add him twice but can't remove him if he's been added twice.
if you try, it bombs.
&lt;/p&gt;
&lt;p&gt;
The desired behaviour in all cases is that adding and removing are effective and idempotent in all three cases.
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>johnlawrenceaspden</dc:creator>

      <pubDate>Tue, 10 May 2011 18:11:01 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/1083#comment:4</link>
      <guid isPermaLink="false">http://localhost/ticket/1083#comment:4</guid>
      <description>
        &lt;p&gt;
It appears to be possible to get into a state where you can't add or remove roles from the command line. Investigating.
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>johnlawrenceaspden</dc:creator>

      <pubDate>Tue, 10 May 2011 20:17:01 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/1083#comment:5</link>
      <guid isPermaLink="false">http://localhost/ticket/1083#comment:5</guid>
      <description>
        &lt;p&gt;
Fixed the problem where you can't delete a role if it's been added twice, but had to leave the add function as it was since putting a commit in it breaks many tests.
&lt;/p&gt;
&lt;p&gt;
It appears that the WUI doesn't call these functions anyway. Left that as it is since we're planning to replace it.
&lt;/p&gt;
&lt;p&gt;
The cli rights command doesn't appear to add the roles that it says it adds. Possibly because it's not doing the required commit? Reported this as a different bug.
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>johnlawrenceaspden</dc:creator>

      <pubDate>Mon, 16 May 2011 09:23:47 GMT</pubDate>
      <title>status changed; resolution set</title>
      <link>http://localhost/ticket/1083#comment:6</link>
      <guid isPermaLink="false">http://localhost/ticket/1083#comment:6</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;assigned&lt;/em&gt; to &lt;em&gt;closed&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;resolution&lt;/strong&gt;
                set to &lt;em&gt;fixed&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item>
 </channel>
</rss>