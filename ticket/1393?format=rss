<?xml version="1.0"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0">
  <channel>
    <title>CKAN: Ticket #1393: Don't skip search tests</title>
    <link>http://localhost/ticket/1393</link>
    <description>&lt;p&gt;
Now we don't use postgres search, all the tests involving search now don't need to be skipped when running on sqlite. Should help coders spot earlier if these tests break.
&lt;/p&gt;
</description>
    <language>en-us</language>
    <image>
      <title>CKAN</title>
      <url>http://assets.okfn.org/p/ckan/img/ckan_logo_shortname.png</url>
      <link>http://localhost/ticket/1393</link>
    </image>
    <generator>Trac 0.12.3</generator>
    <item>
      
        <dc:creator>dread</dc:creator>

      <pubDate>Thu, 13 Oct 2011 11:37:34 GMT</pubDate>
      <title>cc set</title>
      <link>http://localhost/ticket/1393#comment:1</link>
      <guid isPermaLink="false">http://localhost/ticket/1393#comment:1</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;cc&lt;/strong&gt;
              &lt;em&gt;johnglover&lt;/em&gt; added
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;p&gt;
I changed this:
&lt;/p&gt;
&lt;pre class="wiki"&gt;diff -r 47657581fc30 ckan/tests/__init__.py
--- a/ckan/tests/__init__.py	Wed Oct 12 17:58:19 2011 +0100
+++ b/ckan/tests/__init__.py	Thu Oct 13 12:29:54 2011 +0100
@@ -373,7 +373,7 @@
     plugins.load('synchronous_search')
 def is_search_supported():
-    supported_db = "sqlite" not in config.get('sqlalchemy.url')
+    supported_db = True
     return supported_db
 def is_regex_supported():
&lt;/pre&gt;&lt;p&gt;
But there seems to be a problem finding the package when trying to index it:
&lt;/p&gt;
&lt;pre class="wiki"&gt;======================================================================
ERROR: test suite for &amp;lt;class 'ckan.tests.functional.test_search.TestSearch'&amp;gt;
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/dread/hgroot/pyenv-ckan/lib/python2.6/site-packages/nose/suite.py", line 208, in run
    self.setUp()
  File "/home/dread/hgroot/pyenv-ckan/lib/python2.6/site-packages/nose/suite.py", line 291, in setUp
    self.setupContext(ancestor)
  File "/home/dread/hgroot/pyenv-ckan/lib/python2.6/site-packages/nose/suite.py", line 314, in setupContext
    try_run(context, names)
  File "/home/dread/hgroot/pyenv-ckan/lib/python2.6/site-packages/nose/util.py", line 478, in try_run
    return func()
  File "/home/dread/hgroot/ckan/ckan/tests/functional/test_search.py", line 21, in setup_class
    CreateTestData.create_search_test_data()
  File "/home/dread/hgroot/ckan/ckan/lib/create_test_data.py", line 66, in create_search_test_data
    cls.create_arbitrary(search_items)
  File "/home/dread/hgroot/ckan/ckan/lib/create_test_data.py", line 197, in create_arbitrary
    model.repo.commit_and_remove()
  File "/home/dread/hgroot/pyenv-ckan/src/vdm/vdm/sqlalchemy/tools.py", line 110, in commit_and_remove
    self.commit()
  File "/home/dread/hgroot/pyenv-ckan/src/vdm/vdm/sqlalchemy/tools.py", line 100, in commit
    self.session.commit()
  File "/home/dread/hgroot/pyenv-ckan/lib/python2.6/site-packages/sqlalchemy/orm/scoping.py", line 139, in do
    return getattr(self.registry(), name)(*args, **kwargs)
  File "/home/dread/hgroot/pyenv-ckan/lib/python2.6/site-packages/sqlalchemy/orm/session.py", line 614, in commit
    self.transaction.commit()
  File "/home/dread/hgroot/pyenv-ckan/lib/python2.6/site-packages/sqlalchemy/orm/session.py", line 385, in commit
    self._prepare_impl()
  File "/home/dread/hgroot/pyenv-ckan/lib/python2.6/site-packages/sqlalchemy/orm/session.py", line 361, in _prepare_impl
    ext.before_commit(self.session)
  File "/home/dread/hgroot/ckan/ckan/model/extension.py", line 103, in before_commit
    methodcaller('before_commit', session)
  File "/home/dread/hgroot/ckan/ckan/model/extension.py", line 38, in notify_observers
    func(observer)
  File "/home/dread/hgroot/ckan/ckan/model/modification.py", line 45, in before_commit
    self.notify(obj, DomainObjectOperation.new)
  File "/home/dread/hgroot/ckan/ckan/model/modification.py", line 70, in notify
    observer.notify(entity, operation)
  File "/home/dread/hgroot/ckan/ckan/lib/search/__init__.py", line 93, in notify
    package_to_api1(entity, {'model': model}),
  File "/home/dread/hgroot/ckan/ckan/lib/dictization/model_dictize.py", line 231, in package_to_api1
    dictized = package_dictize(pkg, context)
  File "/home/dread/hgroot/ckan/ckan/lib/dictization/model_dictize.py", line 118, in package_dictize
    raise NotFound
NotFound
----------------------------------------------------------------------
Ran 1 test in 2.734s
FAILED (errors=1)
&lt;/pre&gt;&lt;p&gt;
Any ideas John?
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>johnglover</dc:creator>

      <pubDate>Thu, 13 Oct 2011 12:26:05 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/1393#comment:2</link>
      <guid isPermaLink="false">http://localhost/ticket/1393#comment:2</guid>
      <description>
        &lt;p&gt;
Yes, there are a few of these problems with SQLite which is why the tests are being skipped currently. I'm not exactly sure of the reason, it seems that it sometimes drops tables from memory, but we haven't found a solution. Myself and David Raznick were going to spend some time looking at it but haven't had a chance yet.
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>dread</dc:creator>

      <pubDate>Tue, 01 Nov 2011 13:19:50 GMT</pubDate>
      <title>owner, status, milestone changed</title>
      <link>http://localhost/ticket/1393#comment:3</link>
      <guid isPermaLink="false">http://localhost/ticket/1393#comment:3</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;owner&lt;/strong&gt;
              changed from &lt;em&gt;dread&lt;/em&gt; to &lt;em&gt;johnglover&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;new&lt;/em&gt; to &lt;em&gt;assigned&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;milestone&lt;/strong&gt;
                changed from &lt;em&gt;current-ckan-sprint-2011-11-07&lt;/em&gt; to &lt;em&gt;ckan-backlog&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;p&gt;
Thanks John, reassigning to you for the future.
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item>
 </channel>
</rss>