<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      #2550 (User types)
     – CKAN
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">window.location.hash = window.location.hash;</script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="2549.html" title="Ticket #2549" />
        <link rel="last" href="3030.html" title="Ticket #3030" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="2550%3Fformat=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="2550%3Fformat=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="2550%3Fformat=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="2551.html" title="Ticket #2551" />
        <link rel="start" href="../wiki.1.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="1.html" title="Ticket #1" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search CKAN" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="93d81ccf9a7bb1c456462f62";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 2550, escape_newlines: 0}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://ckan.org/"><img src="http://assets.okfn.org/p/ckan/img/ckan_logo_shortname.png" alt="CKAN Trac" height="70" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="../login.html">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li><a href="../about.html">About Trac</a></li><li class="last"><a href="../register.html">Register</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li><a href="../search.html">Search</a></li><li class="last"><a href="../wiki.1.html">Wiki</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="2549.html" title="Ticket #2549">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="2551.html" title="Ticket #2551">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="2550.html">Ticket #2550</a>
          <span class="status">(assigned enhancement)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="../timeline%3Ffrom=2012-06-18T11:06:30Z&amp;precision=second.html" title="2012-06-18T11:06:30Z in Timeline">23 months</a> ago</p>
    <p>Last modified <a class="timeline" href="../timeline%3Ffrom=2012-09-03T10:51:37Z&amp;precision=second.html" title="2012-09-03T10:51:37Z in Timeline">20 months</a> ago</p>
  </div>
  <h2 class="summary searchable">User types</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="../query%3Fstatus=!closed&amp;reporter=ross.html">ross</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="../query%3Fstatus=!closed&amp;owner=icmurray.html">icmurray</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="../query%3Fstatus=!closed&amp;priority=awaiting+merge.html">awaiting merge</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="../milestone/datahub-july.html">datahub-july</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="../query%3Fstatus=!closed&amp;component=ckan.html">ckan</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              <a href="../query%3Fstatus=!closed&amp;cc=~ross.html">ross</a>
        </td>
        <th id="h_repo">
          Repository:
        </th>
        <td headers="h_repo">
              <a href="../query%3Fstatus=!closed&amp;repo=ckan.html">ckan</a>
        </td>
    </tr><tr>
        <th id="h_theme">
          Theme:
        </th>
        <td headers="h_theme">
              <a href="../query%3Fstatus=!closed&amp;theme=none.html">none</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2012-07-19 12:10:56+00:00">
        (last modified by icmurray)
        (<a href="2550%3Faction=diff&amp;version=10.html">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <h2 id="Requirements">Requirements</h2>
<p>
In the data hub plugin we require the ability to differentiate users between those that have paid for a service, and those that haven't. The distinction isn't boolean as there may be levels of service for paid users, so it may be that we need a 'type' of user where there are various grades of 'paid' which are likely to be strings (specific to the data hub).
</p>
<h2 id="Requiredinterface">Required interface</h2>
<p>
Once changes have been made to the user schema, for a given user we want to be able to:
</p>
<ul><li>determine if they have a paid or a free account, and
</li><li>get a string name of the type of paid account.
</li></ul><p>
Care should be taken to ensure that the 'paid' status of the user cannot be set through the API and only by the datahub plugin.
</p>
<h2 id="UserStories">User Stories</h2>
<p>
User stories related to the management, setting and changing of a user's payment level, as well as historical information on payments should be done as part of the work that includes actually allowing purchases.  For now it is adequate that we can manually control these things through paster commands.
</p>
<p>
Payments types should be linear as I don't believe for this type of service a pick-and-mix modular model would work well. Organizations will inherit the payment level of their owner, so currently there is no requirement for it to affect organizations at all.
</p>
<ul><li>As a sysadmin I would like to be able to use a paster command to
manually set a user's payment level, or remove it entirely.
</li></ul><ul><li>As a sysadmin I would like to be able to run a paster command to
view a list of users who have a payment plan, grouped by the plan
that they have.
</li></ul><ul><li>As a sysadmin I would like to be able to use the API to change the
payment status of a specific user through user_create and user_update.
This shouldn't be available to anybody else.
</li></ul><ul><li>As a user, and only if I have one, I'd like to see my current payment
level on my user profile page.
</li></ul><p>
   
</p>
<h2 id="Tasks">Tasks</h2>
<p>
[x] Tests
</p>
<p>
[x] Plugin based migration
</p>
<p>
[x] Code
</p>
<blockquote>
<p>
[x] Model
</p>
</blockquote>
<blockquote>
<p>
[x] API
</p>
</blockquote>
<p>
[x] Documentation
</p>
<h2 id="Estimates">Estimates</h2>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="2550.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-06-25T09:33:45Z&amp;precision=second.html" title="2012-06-25T09:33:45Z in Timeline">23 months</a> ago by ross
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>ckan-v1.8</em> to <em>datahub-july</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="2550.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-06-25T12:16:29Z&amp;precision=second.html" title="2012-06-25T12:16:29Z in Timeline">23 months</a> ago by ross
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>kindly</em> to <em>ross</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Clarify
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="2550.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-06-26T08:43:41Z&amp;precision=second.html" title="2012-06-26T08:43:41Z in Timeline">22 months</a> ago by ross
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="2550%3Faction=diff&amp;version=3.html">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="2550.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-06-26T08:45:16Z&amp;precision=second.html" title="2012-06-26T08:45:16Z in Timeline">22 months</a> ago by ross
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="2550%3Faction=diff&amp;version=4.html">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="2550.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-06-26T17:29:33Z&amp;precision=second.html" title="2012-06-26T17:29:33Z in Timeline">22 months</a> ago by icmurray
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>ross</em> to <em>icmurray</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>accepted</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="2550.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-06-26T17:30:13Z&amp;precision=second.html" title="2012-06-26T17:30:13Z in Timeline">22 months</a> ago by icmurray
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="2550.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-07-08T17:09:30Z&amp;precision=second.html" title="2012-07-08T17:09:30Z in Timeline">22 months</a> ago by icmurray
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Cc</strong>
        <em>ross</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
I've done some initial work on this.  I think the best way is to define extra tables in the datahub extension.  (Rather than: using groups; or modifying the user table; or defining extras for users (in core)).
</p>
<p>
Initially, I've created a new domain object, <a class="missing wiki">PaidService?</a>, which captures the different levels of account a user may have.  And then attached users to this through a secondary table.  I think the advantages of this approach are:
</p>
<ul><li>the <a class="missing wiki">PaidService?</a> table can contain supplementary info about that account type: eg - amount of storage allowed; or cost to sign up etc...
</li><li>allows us to use a modular payment system if biz decide that would be favourable. ie - users belong to multiple <a class="missing wiki">PaidServices?</a> which are independant of one another, rather than a linear hierarcy (eg - "sign up for storage, but not for privacy" vs. "sign up for enterprise level rather than basic level")
</li></ul><p>
The thing that's held me up today is being able to run tests: I'm having a sqlalchemy issue with defining extra mappings on the User table; which then gets dropped when initializing the test setup.  I've gotten to the bottom of the problem, and will ask kindly's advice.
</p>
<p>
In the meantime, I could do with some user stories please.  I think I have a fairly good idea of what's likely to be needed by this ticket; but to what extent should this be exposed to a sysadmin (adding payment schemes; adding users to payment schemes; users seeing which payemtn services they're paying for (public to other users or not?); user's seeing history of payments?  sysadmins seeing list of users for each service level?) - should this be: through a dashboard?  through paster commands?  through the api? all 3?
</p>
<p>
Do we want modular payments or a linear hierarchy of payment schemes?
</p>
<p>
How does is this suppossed to fit in with organizations?  Do organizations purchase on behalf of users as well as individuals being able to make purchases?
</p>
<p>
Do we need to be able to deativate a user's paid service if their payment hasn't come through?
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="2550.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-07-09T11:31:00Z&amp;precision=second.html" title="2012-07-09T11:31:00Z in Timeline">22 months</a> ago by ross
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="2550%3Faction=diff&amp;version=8.html">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
I think you've nailed the user stories already, but have added them to Description to be explicit.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="2550.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-07-17T14:38:44Z&amp;precision=second.html" title="2012-07-17T14:38:44Z in Timeline">22 months</a> ago by rgrp
                </h3>
                
    <div class="comment searchable">
      
      <p>
Sounds good. BTW all users stories if at all possible go in google docs now for permanence. Here is the template: <a class="ext-link" href="https://docs.google.com/document/d/1U5yahDrvp_PKQMNjzI_8u3xixnALf4eNZWK2BdTXOVw/edit"><span class="icon">​</span>https://docs.google.com/document/d/1U5yahDrvp_PKQMNjzI_8u3xixnALf4eNZWK2BdTXOVw/edit</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="2550.html#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-07-19T12:10:56Z&amp;precision=second.html" title="2012-07-19T12:10:56Z in Timeline">22 months</a> ago by icmurray
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>icmurray</em> to <em>ross</em>
    </li><li>
      <strong>Priority</strong>
        changed from <em>awaiting triage</em> to <em>awaiting merge</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>accepted</em> to <em>assigned</em>
    </li><li>
      <strong>Description</strong>
        modified (<a href="2550%3Faction=diff&amp;version=10.html">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Awaiting merge: <a class="ext-link" href="https://github.com/okfn/ckanext-datahub/pull/1"><span class="icon">​</span>https://github.com/okfn/ckanext-datahub/pull/1</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="2550.html#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-09-03T10:51:37Z&amp;precision=second.html" title="2012-09-03T10:51:37Z in Timeline">20 months</a> ago by ross
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>ross</em> to <em>icmurray</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Reassigned to icmurray rather than back to backlog.
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="2550%3Fformat=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="2550%3Fformat=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="2550%3Fformat=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.3</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>