<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      #1134 (CREP0003: Description and Configuration of Harvesters)
     – CKAN
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">window.location.hash = window.location.hash;</script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="1120.html" title="Ticket #1120" />
        <link rel="last" href="1534.html" title="Ticket #1534" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="1134%3Fformat=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="1134%3Fformat=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="1134%3Fformat=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="up" href="../query%3Fstatus=assigned&amp;status=new&amp;status=accepted&amp;status=reopened&amp;milestone=ckan-backlog&amp;group=status&amp;order=time.html" />
        <link rel="next" href="1144.html" title="Ticket #1144" />
        <link rel="start" href="../wiki.1.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="143.html" title="Ticket #143" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search CKAN" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="93d81ccf9a7bb1c456462f62";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 1134, escape_newlines: 0}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://ckan.org/"><img src="http://assets.okfn.org/p/ckan/img/ckan_logo_shortname.png" alt="CKAN Trac" height="70" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="../login.html">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li><a href="../about.html">About Trac</a></li><li class="last"><a href="../register.html">Register</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li><a href="../search.html">Search</a></li><li class="last"><a href="../wiki.1.html">Wiki</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="1120.html" title="Ticket #1120">Previous Ticket</a></span></li><li><a href="../query%3Fstatus=assigned&amp;status=new&amp;status=accepted&amp;status=reopened&amp;milestone=ckan-backlog&amp;group=status&amp;order=time.html">Back to Query</a></li><li class="last"><span><a class="next" href="1144.html" title="Ticket #1144">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="1134.html">Ticket #1134</a>
          <span class="status">(new CREP)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="../timeline%3Ffrom=2011-05-11T10:14:28Z&amp;precision=second.html" title="2011-05-11T10:14:28Z in Timeline">3 years</a> ago</p>
    <p>Last modified <a class="timeline" href="../timeline%3Ffrom=2012-06-15T15:35:54Z&amp;precision=second.html" title="2012-06-15T15:35:54Z in Timeline">23 months</a> ago</p>
  </div>
  <h2 class="summary searchable">CREP0003: Description and Configuration of Harvesters</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="../query%3Fstatus=!closed&amp;reporter=amercader.html">amercader</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="../query%3Fstatus=!closed&amp;priority=major.html">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="../milestone/ckan-backlog.html">ckan-backlog</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="../query%3Fstatus=!closed&amp;component=ckan.html">ckan</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
              <a href="../query%3Fstatus=!closed&amp;keywords=~Harvesting.html">Harvesting</a>
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              david.raznick@…
        </td>
        <th id="h_repo">
          Repository:
        </th>
        <td headers="h_repo">
              <a href="../query%3Fstatus=!closed&amp;repo=ckanext-harvest.html">ckanext-harvest</a>
        </td>
    </tr><tr>
        <th id="h_theme">
          Theme:
        </th>
        <td headers="h_theme">
              <a href="../query%3Fstatus=!closed&amp;theme=none.html">none</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
<strong>Proposer</strong>: Adrià Mercader
</p>
<h2 id="Abstract">Abstract</h2>
<p>
The new harvester interface allows to create harvesters for different
sources, but right now harvesters don't have many ways to describe and
configure themselves. We need a way of allowing them to:
</p>
<ul><li>Expose their type and other details so they can be used internally
and on the UI.
</li><li>Define configuration settings for particular harvester instances.
</li></ul><h2 id="TheProblem">The Problem</h2>
<h3 id="Harvesterdescription">Harvester description</h3>
<p>
The current UI for adding and editing harvest sources is the same used
in ckanext-dgu, and thus the 3 harvester types used in DGU to harvest
various GEMINI realted sources are hardcoded in the form. The form will 
be migrated to a DGU-independent one, so we need the harvesters to 
provide all the necessary data. There is a current <tt>get_type</tt> method
that returns the harvester type, but for make it compatible with the DGU
forms, it returns a machine-readable string (e.g. "CSW Server"), making
it error prone.
</p>
<h3 id="Arbitraryconfiguration">Arbitrary configuration</h3>
<p>
In the current implementation, when the harvest process is started,
ckanext-harvest looks for all the available plugins that implement the 
<tt>IHarvester</tt> interface and calls the appropiate methods for the
current stage (<tt>gather_stage</tt>,<tt>fetch_stage</tt>,<tt>import_stage</tt>).
At these stages, harvesters have no way of applying arbitrary
configuration options, so all harvesters of the same type behave on the
same way.
For instance, the CKAN harvester needs a way to define the API version
to use when harvesting remote instances (Right now, the version 2 is
hardcoded on the code).
</p>
<h2 id="Specification">Specification</h2>
<h3 id="Harvesterdescription1">Harvester description</h3>
<p>
Harvesters will need to provide the following information so the UI form
can be built:
</p>
<ul><li>name: machine-readable name (e.g. "waf"). This will be the value
stored in the database, and the one used by ckanext-harvest to
call the appropiate harvester.
</li><li>title: human-readable name (e.g. "Web Accessible Folder (WAF)").
This will appear in the form's select box.
</li><li>description: a description of what the harvester does (e.g. "A Web 
Accessible Folder (WAF) displaying a list of GEMINI 2.1 
documents"). This will appear on the form as a guidance to the
user.
</li></ul><p>
The way to provide it will be an <tt>info</tt> method that all harvesters
must implement, which will return a dictionary with the previous
elements:
</p>
<pre class="wiki">    {
        'name': 'csw',
        'title': 'CSW Server',
        'description': 'A server that implements OGC's Catalog Service 
                        for the Web (CSW) standard'
    }
</pre><h3 id="Arbitraryconfiguration1">Arbitrary configuration</h3>
<p>
As different harvesters will have very different needs, we need to
provide a way to persist arbitrary configuration flags for each harvest
source. The more flexible way given the current architecture in my
opinion would be to store the configuration options as a JSON encoded
object as a property of the harvest source (There already is an unused
DB field called <tt>config</tt> in the database) (Maybe using <a class="missing wiki">JsonType?</a>?).
</p>
<p>
This will mean adding an extra field in the harvest source form to allow
entering the configuration. This could be just a simple text field where
users enter the JSON encoded object or a more clever mechanism (i.e an 
"Add a configuration flag" link that adds two new text fields for the
key and value for each flag, and a mechanism to later build the JSON 
object). In any case, this should probably be hidden in an "Advance
options" section.
</p>
<h2 id="Whydoitthisway">Why do it this way</h2>
<h3 id="Harvesterdescription2">Harvester description</h3>
<p>
The <tt>info</tt> method would provide a single point to get all the
information related to the harvester, and future properties could be 
added to the dictionary returned without having to modify the interface.
</p>
<h3 id="Arbitraryconfiguration2">Arbitrary configuration</h3>
<p>
There is an already existing <tt>config</tt> field in the database, so we
won't need to change the model. 
Harvesters could access the config object at any of the stages. Of
course they could provide default values in their implementations so
users don't need to enter them everytime.
</p>
<h2 id="Implementationplan">Implementation plan</h2>
<h3 id="Deliverables">Deliverables</h3>
<h3 id="Risksandmitigations">Risks and mitigations</h3>
<p>
The highest risk on the harvesters <tt>info</tt> method side is that 
harvester implementation don't offer one of the necessary properties
(namely name and title). This could fire a warning when showing the 
UI form or using the CLI.
</p>
<h3 id="Participants">Participants</h3>
<p>
Adrià Mercader to do it.
</p>
<h3 id="Progress">Progress</h3>
<p>
None yet.
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="1134.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-05-11T14:47:08Z&amp;precision=second.html" title="2011-05-11T14:47:08Z in Timeline">3 years</a> ago by thejimmyg
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Cc</strong>
        <em>david.raznick@…</em> added
    </li><li>
      <strong>Priority</strong>
        changed from <em>awaiting triage</em> to <em>major</em>
    </li><li>
      <strong>state</strong>
        changed from <em>draft</em> to <em>accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Great stuff.
</p>
<p>
Yes, I agree with all this, but as initial thoughts I suggest that for phase 1, the info() method returns one more key called "form_config_interface" which takes a string representing a the type of interface for the config field on the form. If the key is missing it is treated as "None".
</p>
<p>
The two possible values are:
</p>
<p>
None - the field is not present and must always be stored as NULL
Text - a single text field will be provided on the interface
</p>
<p>
Whatever the interface, the value built will always be stored in the config column of the table.
</p>
<p>
We then also provide a "get_schema()" method that returns a schema cablable of parsing the data submitted by the form and storing it as a single key named "config". ckanext-inspire will then add other functions to the schema for URL etc so that regardless of what the harvest plugin does, the key fields ckanext-harvest are always there.
</p>
<p>
This then allows:
</p>
<ul><li>Customiseable config interfaces
</li><li>Customisable valiation
</li><li>A consistent place to store config in the database
</li></ul><p>
Sound good?
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="1134.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-05-17T09:12:11Z&amp;precision=second.html" title="2011-05-17T09:12:11Z in Timeline">3 years</a> ago by sebbacon
                </h3>
                
    <div class="comment searchable">
      
      <p>
Agreed with James that we should consider *from the start* how to provide for a nice UI -- my worry is if we start out with people editing raw JSON we'll end up keeping that for years :)
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="1134.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-06-15T15:35:54Z&amp;precision=second.html" title="2012-06-15T15:35:54Z in Timeline">23 months</a> ago by seanh
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        set to <em>ckan-backlog</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="1134%3Fformat=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="1134%3Fformat=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="1134%3Fformat=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.3</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>