<?xml version="1.0"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0">
  <channel>
    <title>CKAN: Ticket #1629: permissions changed during upgrade to 1.5.1</title>
    <link>http://localhost/ticket/1629</link>
    <description>&lt;p&gt;
This was seen on datacatalogs. When we upgraded it 1.5 to 1.5.1 we saw some permissions being reset so that it could be spammed. Anonymous and logged in users were given anon_editor and editor permissions. I don't know what the previous config was. Permissions for sysadmins remain unaffected.
&lt;/p&gt;
</description>
    <language>en-us</language>
    <image>
      <title>CKAN</title>
      <url>http://assets.okfn.org/p/ckan/img/ckan_logo_shortname.png</url>
      <link>http://localhost/ticket/1629</link>
    </image>
    <generator>Trac 0.12.3</generator>
    <item>
      
        <dc:creator>johnglover</dc:creator>

      <pubDate>Tue, 10 Jan 2012 17:08:54 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/1629#comment:1</link>
      <guid isPermaLink="false">http://localhost/ticket/1629#comment:1</guid>
      <description>
        &lt;p&gt;
anon_editor and editor were given the create-package role, I had previously removed it via paster roles deny [anon_]editor create-package.
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>dread</dc:creator>

      <pubDate>Tue, 17 Jan 2012 18:00:22 GMT</pubDate>
      <title>status changed; resolution set</title>
      <link>http://localhost/ticket/1629#comment:2</link>
      <guid isPermaLink="false">http://localhost/ticket/1629#comment:2</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;new&lt;/em&gt; to &lt;em&gt;closed&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;resolution&lt;/strong&gt;
                set to &lt;em&gt;fixed&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;p&gt;
This permission is set every time you do a db_upgrade. ckan.model.&lt;span class="underline"&gt;init&lt;/span&gt;.py calls init_configuration_data() which calls init_authz_configuration_data() which restores specific roles to the defaults.
&lt;/p&gt;
&lt;p&gt;
I agree that it doesn't seem right in this circumstance, but the way I setup roles is for 'editor', 'anon_editor' and 'reader' to have a fixed set of actions. See comment in ckan/model/authz.py:
&lt;/p&gt;
&lt;pre class="wiki"&gt;# These define what is meant by 'editor' and 'reader' for all ckan
# instances - locked down or otherwise. They get refreshed on every db_upgrade.
# So if you want to lock down an ckan instance, change Visitor and LoggedIn
# to have a new role which for which you can allow your customised actions.
&lt;/pre&gt;&lt;p&gt;
Basically it seemed wrong when people changed 'editor' to something that couldn't edit. They should call that role something else.
&lt;/p&gt;
&lt;p&gt;
But people *are* able to edit these roles (even though they are reset on upgrade) and they should be prevented. I've put this in a new ticket: &lt;a class="ext-link" href="http://trac.ckan.org/ticket/1679"&gt;&lt;span class="icon"&gt;â€‹&lt;/span&gt;http://trac.ckan.org/ticket/1679&lt;/a&gt;
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item>
 </channel>
</rss>