<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  


  <head>
    <title>
      #1413 (Ask users to 'add email address' when logged in)
     â€“ CKAN
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!--[if IE]><script type="text/javascript">window.location.hash = window.location.hash;</script><![endif]-->
        <link rel="search" href="../search.html" />
        <link rel="prev" href="1388.html" title="Ticket #1388" />
        <link rel="last" href="1780.html" title="Ticket #1780" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="1413%3Fformat=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="1413%3Fformat=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="1413%3Fformat=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="up" href="../query%3Fstatus=closed&amp;milestone=ckan-backlog&amp;group=resolution&amp;order=time.html" />
        <link rel="next" href="1528.html" title="Ticket #1528" />
        <link rel="start" href="../wiki.1.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="819.html" title="Ticket #819" />
        <link rel="shortcut icon" href="../chrome/common/trac.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/common/trac.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearch" title="Search CKAN" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="93d81ccf9a7bb1c456462f62";
    </script>
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/babel.js"></script><script type="text/javascript" src="../chrome/common/js/messages/en_US.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script><script type="text/javascript" src="../chrome/common/js/folding.js"></script><script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="../chrome/common/js/resizer.js"></script><script type="text/javascript" src="../chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 1413, escape_newlines: 0}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://ckan.org/"><img src="http://assets.okfn.org/p/ckan/img/ckan_logo_shortname.png" alt="CKAN Trac" height="70" /></a>
      </div>
      <form id="search" action="../search.html" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="../login.html">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li><a href="../wiki/TracGuide.html">Help/Guide</a></li><li><a href="../about.html">About Trac</a></li><li class="last"><a href="../register.html">Register</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li><a href="../search.html">Search</a></li><li class="last"><a href="../wiki.1.html">Wiki</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="1388.html" title="Ticket #1388">Previous Ticket</a></span></li><li><a href="../query%3Fstatus=closed&amp;milestone=ckan-backlog&amp;group=resolution&amp;order=time.html">Back to Query</a></li><li class="last"><span><a class="next" href="1528.html" title="Ticket #1528">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="1413.html">Ticket #1413</a>
          <span class="status">(closed enhancement: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="../timeline%3Ffrom=2011-10-24T10:45:08Z&amp;precision=second.html" title="2011-10-24T10:45:08Z in Timeline">3 years</a> ago</p>
    <p>Last modified <a class="timeline" href="../timeline%3Ffrom=2012-02-23T18:08:06Z&amp;precision=second.html" title="2012-02-23T18:08:06Z in Timeline">2 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Ask users to 'add email address' when logged in</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="../query%3Fstatus=!closed&amp;reporter=shevski.html">shevski</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="../query%3Fstatus=!closed&amp;owner=seanh.html">seanh</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="../query%3Fstatus=!closed&amp;priority=awaiting+triage.html">awaiting triage</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="../milestone/ckan-backlog.html">ckan-backlog</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="../query%3Fstatus=!closed&amp;component=ckan.html">ckan</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_repo">
          Repository:
        </th>
        <td headers="h_repo">
              <a href="../query%3Fstatus=!closed&amp;repo=ckan.html">ckan</a>
        </td>
    </tr><tr>
        <th id="h_theme">
          Theme:
        </th>
        <td headers="h_theme">
              <a href="../query%3Fstatus=!closed&amp;theme=notifications.html">notifications</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2011-10-27 13:20:46+00:00">
        (last modified by dread)
        (<a href="1413%3Faction=diff&amp;version=1.html">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <p>
I'd like us to display a one-off banner that prompts users who log into thedatahub.org to go and update &amp; their profile &amp; fill in their email address (if we could do it just for those who don't have an email address, then even better)
That is, once they log in, they see a banner which says:
Please update your profile [here] and add your email address, so you can receive notifications, be able to reset your password and get updates
</p>
<p>
Then when we build notifications or if we decide to survey people, we can actually contact them. Email address should be required as standard
</p>
<p>
DR: Also, mention their Full Name too - v. useful for selecting correct user in group curation
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="1413.html#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-10-27T13:20:46Z&amp;precision=second.html" title="2011-10-27T13:20:46Z in Timeline">3 years</a> ago by dread
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        set to <em>seanh</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li><li>
      <strong>Description</strong>
        modified (<a href="1413%3Faction=diff&amp;version=1.html">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="1413.html#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-11-28T11:18:33Z&amp;precision=second.html" title="2011-11-28T11:18:33Z in Timeline">2 years</a> ago by seanh
                </h3>
                
    <div class="comment searchable">
      
      <p>
I've made a first attempt at this here:
</p>
<p>
<a class="ext-link" href="https://github.com/seanh/ckan/compare/feature-1413-ask-users-to-add-email-address"><span class="icon">â€‹</span>https://github.com/seanh/ckan/compare/feature-1413-ask-users-to-add-email-address</a>
</p>
<p>
I used flash_notice() to ask the user to add an email whenever they visit their account page, if they don't have one already. This means they'll see the notice when they login, because after login they are redirected to their account page. Issues:
</p>
<p>
Is it okay to approximate 'once they log in' as 'whenever they visit their account page' like this?
</p>
<p>
Do I need to do something to support i18n for the string I added? I looked at users of flash_*() elsewhere and they seemed to be hardcoding the strings in English.
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="1413.html#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-11-28T11:53:55Z&amp;precision=second.html" title="2011-11-28T11:53:55Z in Timeline">2 years</a> ago by dread
                </h3>
                
    <div class="comment searchable">
      
      <blockquote>
<p>
approximate 'once they log in' as 'whenever they visit their account page' 
</p>
</blockquote>
<p>
I had imagined that this would be done in the user.py:logged_in method, but doing it in your way sounds like an even better plan. 
</p>
<p>
Another thought is: a lot of people might just use the cookie and v. rarely logout/in. Perhaps it could be done when they come back to the site at intervals (e.g. daily)?
</p>
<blockquote>
<p>
i18n
</p>
</blockquote>
<p>
Yes your strings should be internationalised because they are user visible.
</p>
<p>
You're right that these other strings should be internationalised. I've created a separate ticket for this: <a class="closed ticket" href="1491.html" title="defect: Visible strings need internationalisation (closed: fixed)">#1491</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="1413.html#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-11-29T14:05:34Z&amp;precision=second.html" title="2011-11-29T14:05:34Z in Timeline">2 years</a> ago by seanh
                </h3>
                
    <div class="comment searchable">
      
      <blockquote>
<p>
Another thought is: a lot of people might just use the cookie and v. rarely logout/in. 
Perhaps it could be done when they come back to the site at intervals (e.g. daily)?
</p>
</blockquote>
<p>
As discussed on IRC I've moved the notice from the user account page to the front page, in the hopes that people will see it often enough even if they are always logged in via a cookie. As discussed on IRC, we could make the notice appear on every page but no more than once per day, but that would be more complicated to implement and more likely to break.
</p>
<blockquote>
<p>
Yes your strings should be internationalised because they are user visible.
</p>
</blockquote>
<p>
Done.
</p>
<blockquote>
<p>
You're right that these other strings should be internationalised. I've created a 
separate ticket for this: <a class="closed ticket" href="1491.html" title="defect: Visible strings need internationalisation (closed: fixed)">#1491</a>
</p>
</blockquote>
<p>
Also done! :)
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="1413.html#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-11-29T19:32:40Z&amp;precision=second.html" title="2011-11-29T19:32:40Z in Timeline">2 years</a> ago by seanh
                </h3>
                
    <div class="comment searchable">
      
      <p>
Added a 'please enter your full name' flash notice as well (the two are combined into one if they have neither full name nor email), added unit tests, fixed some issues.
</p>
<p>
Still need to adjust the strings and change the full name notice so that it applies to people with gmail IDs only.
</p>
<p>
<a class="ext-link" href="https://github.com/seanh/ckan/compare/feature-1413-ask-users-to-add-email-address"><span class="icon">â€‹</span>https://github.com/seanh/ckan/compare/feature-1413-ask-users-to-add-email-address</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="1413.html#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-12-05T12:28:11Z&amp;precision=second.html" title="2011-12-05T12:28:11Z in Timeline">2 years</a> ago by seanh
                </h3>
                
    <div class="comment searchable">
      
      <p>
Adjusted the 'please add your email' string and changed the 'please add your full name' notice to be used only for Google OpenID users. Finished?
</p>
<p>
<a class="ext-link" href="https://github.com/seanh/ckan/commits/feature-1413-ask-users-to-add-email-address"><span class="icon">â€‹</span>https://github.com/seanh/ckan/commits/feature-1413-ask-users-to-add-email-address</a>
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="1413.html#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-12-07T13:24:06Z&amp;precision=second.html" title="2011-12-07T13:24:06Z in Timeline">2 years</a> ago by seanh
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="1413.html#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2011-12-07T14:51:12Z&amp;precision=second.html" title="2011-12-07T14:51:12Z in Timeline">2 years</a> ago by dread
                </h3>
                
    <div class="comment searchable">
      
      <p>
Code reviewed - looks really good. Do merge in to master if it is not already.
</p>
<p>
A couple of tips: 
</p>
<ul><li>we all use 'model.User' instead of 'model.user.User' but it's not important for tests...
</li><li>probably better to use <a class="missing wiki">CreateTestData?</a>.create_user() to create user objects in the future, avoiding faffing around with creating revisions etc. that are also nastier to debug when they go wrong.
</li></ul>
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="1413.html#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="../timeline%3Ffrom=2012-02-23T18:08:06Z&amp;precision=second.html" title="2012-02-23T18:08:06Z in Timeline">2 years</a> ago by dread
                </h3>
                
    <div class="comment searchable">
      
      <p>
Went into CKAN 1.6
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="1413%3Fformat=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="1413%3Fformat=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="1413%3Fformat=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="../about.html"><strong>Trac 0.12.3</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
  </body>
</html>