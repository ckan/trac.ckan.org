<?xml version="1.0"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0">
  <channel>
    <title>CKAN: Ticket #908: Issues deploying extensions with modwsgi</title>
    <link>http://localhost/ticket/908</link>
    <description>&lt;p&gt;
Some extensions import pylons features (such as request) at root.
&lt;/p&gt;
&lt;p&gt;
Have encountered following issues:
&lt;/p&gt;
&lt;ol&gt;&lt;li&gt;You need to import ckanext before any ckan stuff in your wsgi script (extension stats and dataapi)
&lt;/li&gt;&lt;/ol&gt;&lt;ol start="2"&gt;&lt;li&gt;Running under wsgi daemon mode (normal mode is fine!) the front page (front page only) will not work (does not occur with disqus or synchronous_search but does with stats and dataapi extensions). You get errors like this in the log:
&lt;/li&gt;&lt;/ol&gt;&lt;pre class="wiki"&gt;[Mon Jan 17 09:01:19 2011] [error] Exception KeyError: KeyError(-1218594160,) in &amp;lt;module 'threading' from '/usr/lib/python2.6/threading.pyc'&amp;gt; ignored
[Mon Jan 17 09:01:20 2011] [error] Exception AttributeError: "'NoneType' object has no attribute 'clearing'" in &amp;lt;bound method PluginEnvironment.__del__ of  Services for Environment '&amp;lt;default&amp;gt;'
&lt;/pre&gt;</description>
    <language>en-us</language>
    <image>
      <title>CKAN</title>
      <url>http://assets.okfn.org/p/ckan/img/ckan_logo_shortname.png</url>
      <link>http://localhost/ticket/908</link>
    </image>
    <generator>Trac 0.12.3</generator>
    <item>
      
        <dc:creator>rgrp</dc:creator>

      <pubDate>Wed, 19 Jan 2011 19:50:10 GMT</pubDate>
      <title>description changed</title>
      <link>http://localhost/ticket/908#comment:1</link>
      <guid isPermaLink="false">http://localhost/ticket/908#comment:1</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;description&lt;/strong&gt;
              modified (&lt;a href="/ticket/908?action=diff&amp;amp;version=1"&gt;diff&lt;/a&gt;)
            &lt;/li&gt;
          &lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>wwaites</dc:creator>

      <pubDate>Sun, 30 Jan 2011 16:08:15 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/908#comment:2</link>
      <guid isPermaLink="false">http://localhost/ticket/908#comment:2</guid>
      <description>
        &lt;p&gt;
see also from &lt;a class="ext-link" href="http://knowledgeforge.net/okfn/tasks/ticket/485"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://knowledgeforge.net/okfn/tasks/ticket/485&lt;/a&gt;
&lt;/p&gt;
&lt;pre class="wiki"&gt;(pyenv)okfn@eu7:~/var/srvc/ckan.net$ sudo uwsgi -C -iH /home/okfn/var/srvc/ckan.net/pyenv --paste config:ckan.net.ini --uid www-data -s 10.48.162.201:9001
*** Starting uWSGI 0.9.6.6 (32bit) on [Sun Jan 30 16:00:13 2011] ***
compiled with version: 4.4.3
Python version: 2.6.5 (r265:79063, Apr 16 2010, 13:28:26)
[GCC 4.4.3]
uWSGI running as root, you can use --uid/--gid/--chroot options
setuid() to 33
 *** WARNING: you are running uWSGI without its master process manager ***
your memory page size is 4096 bytes
allocated 412 bytes (0 KB) for 1 request's buffer.
Setting PythonHome to /home/okfn/var/srvc/ckan.net/pyenv...
binding on TCP port: 9001
your server socket listen backlog is limited to 64 connections
initializing hooks...done.
Loading paste environment: config:ckan.net.ini
Traceback (most recent call last):
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/paste/deploy/__init__.py", line 3, in &amp;lt;module&amp;gt;
    from loadwsgi import *
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/paste/deploy/loadwsgi.py", line 8, in &amp;lt;module&amp;gt;
    import pkg_resources
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pkg_resources.py", line 2691, in &amp;lt;module&amp;gt;
    add_activation_listener(lambda dist: dist.activate())
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pkg_resources.py", line 668, in subscribe
    callback(dist)
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pkg_resources.py", line 2691, in &amp;lt;lambda&amp;gt;
    add_activation_listener(lambda dist: dist.activate())
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pkg_resources.py", line 2195, in activate
    map(declare_namespace, self._get_metadata('namespace_packages.txt'))
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pkg_resources.py", line 1790, in declare_namespace
    _handle_ns(packageName, path_item)
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pkg_resources.py", line 1761, in _handle_ns
    loader.load_module(packageName); module.__path__ = path
  File "/usr/lib/python2.6/pkgutil.py", line 238, in load_module
    mod = imp.load_module(fullname, self.file, self.filename, self.etc)
  File "/home/okfn/var/srvc/ckan.net/pyenv/src/ckanext-dataapi/ckanext/dataapi/__init__.py", line 36, in &amp;lt;module&amp;gt;    from pylons import config
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pylons/__init__.py", line 4, in &amp;lt;module&amp;gt;
    from pylons.config import config
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pylons/config.py", line 2, in &amp;lt;module&amp;gt;
    from pylons.configuration import *
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pylons/configuration.py", line 25, in &amp;lt;module&amp;gt;
    import pylons.legacy
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pylons/legacy.py", line 11, in &amp;lt;module&amp;gt;
    from pylons.util import deprecated, func_move
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/pylons/util.py", line 18, in &amp;lt;module&amp;gt;
    from paste.script.appinstall import Installer
  File "/home/okfn/var/srvc/ckan.net/pyenv/lib/python2.6/site-packages/paste/script/appinstall.py", line 23, in &amp;lt;module&amp;gt;
    from paste.deploy import appconfig
ImportError: cannot import name appconfig
&lt;/pre&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>pudo</dc:creator>

      <pubDate>Wed, 02 Feb 2011 11:06:43 GMT</pubDate>
      <title>owner changed</title>
      <link>http://localhost/ticket/908#comment:3</link>
      <guid isPermaLink="false">http://localhost/ticket/908#comment:3</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;owner&lt;/strong&gt;
              changed from &lt;em&gt;rgrp&lt;/em&gt; to &lt;em&gt;pudo&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>pudo</dc:creator>

      <pubDate>Wed, 02 Feb 2011 15:04:16 GMT</pubDate>
      <title>status changed; resolution set</title>
      <link>http://localhost/ticket/908#comment:4</link>
      <guid isPermaLink="false">http://localhost/ticket/908#comment:4</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;new&lt;/em&gt; to &lt;em&gt;closed&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;resolution&lt;/strong&gt;
                set to &lt;em&gt;fixed&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;p&gt;
fixed in &lt;a class="ext-link" href="https://bitbucket.org/okfn/ckan/changeset/08c0e1a819e4"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;https://bitbucket.org/okfn/ckan/changeset/08c0e1a819e4&lt;/a&gt; and &lt;a class="ext-link" href="https://bitbucket.org/okfn/ckanext-stats/changeset/6e86c071db99"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;https://bitbucket.org/okfn/ckanext-stats/changeset/6e86c071db99&lt;/a&gt;
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>wwaites</dc:creator>

      <pubDate>Wed, 02 Feb 2011 15:20:52 GMT</pubDate>
      <title>status, summary changed; resolution deleted</title>
      <link>http://localhost/ticket/908#comment:5</link>
      <guid isPermaLink="false">http://localhost/ticket/908#comment:5</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;closed&lt;/em&gt; to &lt;em&gt;reopened&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;resolution&lt;/strong&gt;
                &lt;em&gt;fixed&lt;/em&gt; deleted
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;summary&lt;/strong&gt;
                changed from &lt;em&gt;Issues deploying extensions with modwsgi&lt;/em&gt; to &lt;em&gt;Issues deploying extensions with modwsgi / uwsgi&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;p&gt;
Not fixed. Try running with:
&lt;/p&gt;
&lt;pre class="wiki"&gt;uwsgi -C -iH /path/to/your/pyenv --paste config:ckan.net.ini -s 127.0.0.1:9000
&lt;/pre&gt;&lt;p&gt;
Still get giant traceback relating to a circular import centered on an arbitrary plugin
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>pudo</dc:creator>

      <pubDate>Thu, 03 Feb 2011 10:56:18 GMT</pubDate>
      <title>status, milestone changed; resolution set</title>
      <link>http://localhost/ticket/908#comment:6</link>
      <guid isPermaLink="false">http://localhost/ticket/908#comment:6</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;reopened&lt;/em&gt; to &lt;em&gt;closed&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;resolution&lt;/strong&gt;
                set to &lt;em&gt;fixed&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;milestone&lt;/strong&gt;
                changed from &lt;em&gt;ckan-v1.3&lt;/em&gt; to &lt;em&gt;ckan-v1.4-sprint-1&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;p&gt;
I've moved the uswgi/nginx part to &lt;a class="closed ticket" href="http://localhost/ticket/952" title="task: CKAN should run under nginx/uswgi (closed: invalid)"&gt;#952&lt;/a&gt;, closing this issue since the problem it describes has been fixed.
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item>
 </channel>
</rss>