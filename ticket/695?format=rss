<?xml version="1.0"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" version="2.0">
  <channel>
    <title>CKAN: Ticket #695: Search indexing broken on ckan.net</title>
    <link>http://localhost/ticket/695</link>
    <description>&lt;p&gt;
e.g. searching for 'buddhist' or 'sanskrit', you don't get this newly created package:
&lt;a class="ext-link" href="http://ckan.net/package/digitalsanskritbuddhistcanon"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://ckan.net/package/digitalsanskritbuddhistcanon&lt;/a&gt;
&lt;/p&gt;
</description>
    <language>en-us</language>
    <image>
      <title>CKAN</title>
      <url>http://assets.okfn.org/p/ckan/img/ckan_logo_shortname.png</url>
      <link>http://localhost/ticket/695</link>
    </image>
    <generator>Trac 0.12.3</generator>
    <item>
      
        <dc:creator>dread</dc:creator>

      <pubDate>Wed, 13 Oct 2010 17:34:09 GMT</pubDate>
      <title>description changed</title>
      <link>http://localhost/ticket/695#comment:1</link>
      <guid isPermaLink="false">http://localhost/ticket/695#comment:1</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;description&lt;/strong&gt;
              modified (&lt;a href="/ticket/695?action=diff&amp;amp;version=1"&gt;diff&lt;/a&gt;)
            &lt;/li&gt;
          &lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>pudo</dc:creator>

      <pubDate>Mon, 18 Oct 2010 08:49:11 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/695#comment:2</link>
      <guid isPermaLink="false">http://localhost/ticket/695#comment:2</guid>
      <description>
        &lt;p&gt;
This is triggered by an issue where having local blinker notifications without asynchronous notifications will break indexing. The issues cause is still unknown, but one possible fix is running CKAN with a queue enabled, synchronous indexing on and no queue consumers attached. Not a real solution, but made possible in cset:a065dbc8041c
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>pudo</dc:creator>

      <pubDate>Mon, 18 Oct 2010 10:57:36 GMT</pubDate>
      <title>status changed; resolution set</title>
      <link>http://localhost/ticket/695#comment:3</link>
      <guid isPermaLink="false">http://localhost/ticket/695#comment:3</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;new&lt;/em&gt; to &lt;em&gt;closed&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;resolution&lt;/strong&gt;
                set to &lt;em&gt;wontfix&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>ollyc</dc:creator>

      <pubDate>Thu, 21 Oct 2010 15:22:17 GMT</pubDate>
      <title>status changed; resolution deleted</title>
      <link>http://localhost/ticket/695#comment:4</link>
      <guid isPermaLink="false">http://localhost/ticket/695#comment:4</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;closed&lt;/em&gt; to &lt;em&gt;reopened&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;resolution&lt;/strong&gt;
                &lt;em&gt;wontfix&lt;/em&gt; deleted
            &lt;/li&gt;
          &lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>ollyc</dc:creator>

      <pubDate>Thu, 21 Oct 2010 16:06:09 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/695#comment:5</link>
      <guid isPermaLink="false">http://localhost/ticket/695#comment:5</guid>
      <description>
        &lt;p&gt;
This is down to blinker not persisting the signal objects. Although the docs claim:
&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;
"Every call to signal('name') returns the same signal object, allowing
unconnected parts of code (different modules, plugins, anything) to all
use the same signal without requiring any code sharing or special
imports"
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;
This isn't true unless you maintain a reference to the signal object. To demonstrate this:
&lt;/p&gt;
&lt;pre class="wiki"&gt;&amp;gt;&amp;gt;&amp;gt; import gc
&amp;gt;&amp;gt;&amp;gt; from blinker import signal
&amp;gt;&amp;gt;&amp;gt; signal_id = id(signal('Package'))
&amp;gt;&amp;gt;&amp;gt; gc.collect()
0
&amp;gt;&amp;gt;&amp;gt; id(signal('Package')) == signal_id
False
&lt;/pre&gt;&lt;p&gt;
The synchronous notifications code connects to signals without storing the signal objects, which are subsequently garbage collected and hence never fire.
The async notifications stores references to all signals as a class attribute, so this problem is not seen when async notifications are enabled.
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>dread</dc:creator>

      <pubDate>Thu, 21 Oct 2010 16:11:21 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/695#comment:6</link>
      <guid isPermaLink="false">http://localhost/ticket/695#comment:6</guid>
      <description>
        &lt;p&gt;
Superb finding Friedrich! Any chance of a quick fix for metastable then?
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>dread</dc:creator>

      <pubDate>Thu, 21 Oct 2010 16:12:04 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/695#comment:7</link>
      <guid isPermaLink="false">http://localhost/ticket/695#comment:7</guid>
      <description>
        &lt;p&gt;
Sorry, I meant Olly!
&lt;/p&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>ollyc</dc:creator>

      <pubDate>Fri, 22 Oct 2010 11:50:40 GMT</pubDate>
      <title></title>
      <link>http://localhost/ticket/695#comment:8</link>
      <guid isPermaLink="false">http://localhost/ticket/695#comment:8</guid>
      <description>
        &lt;p&gt;
Fix and tests for this are here:
&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;&lt;a class="ext-link" href="http://bitbucket.org/ollyc/ckan/changeset/48234e36ee61"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://bitbucket.org/ollyc/ckan/changeset/48234e36ee61&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a class="ext-link" href="http://bitbucket.org/ollyc/ckan/changeset/f1447bbc9d65"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://bitbucket.org/ollyc/ckan/changeset/f1447bbc9d65&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a class="ext-link" href="http://bitbucket.org/ollyc/ckan/changeset/1d3cb5378a2f"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://bitbucket.org/ollyc/ckan/changeset/1d3cb5378a2f&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a class="ext-link" href="http://bitbucket.org/ollyc/ckan/changeset/e8409c84683d"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://bitbucket.org/ollyc/ckan/changeset/e8409c84683d&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a class="ext-link" href="http://bitbucket.org/ollyc/ckan/changeset/8e89cbce15c7"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://bitbucket.org/ollyc/ckan/changeset/8e89cbce15c7&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a class="ext-link" href="http://bitbucket.org/ollyc/ckan/changeset/d1d63db64585"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://bitbucket.org/ollyc/ckan/changeset/d1d63db64585&lt;/a&gt;
&lt;/li&gt;&lt;li&gt;&lt;a class="ext-link" href="http://bitbucket.org/ollyc/ckan/changeset/3d9eb4172f48"&gt;&lt;span class="icon"&gt;​&lt;/span&gt;http://bitbucket.org/ollyc/ckan/changeset/3d9eb4172f48&lt;/a&gt;
&lt;/li&gt;&lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item><item>
      
        <dc:creator>dread</dc:creator>

      <pubDate>Fri, 22 Oct 2010 17:02:53 GMT</pubDate>
      <title>status changed; resolution set</title>
      <link>http://localhost/ticket/695#comment:9</link>
      <guid isPermaLink="false">http://localhost/ticket/695#comment:9</guid>
      <description>
          &lt;ul&gt;
            &lt;li&gt;&lt;strong&gt;status&lt;/strong&gt;
                changed from &lt;em&gt;reopened&lt;/em&gt; to &lt;em&gt;closed&lt;/em&gt;
            &lt;/li&gt;
            &lt;li&gt;&lt;strong&gt;resolution&lt;/strong&gt;
                set to &lt;em&gt;fixed&lt;/em&gt;
            &lt;/li&gt;
          &lt;/ul&gt;
        &lt;p&gt;
These changesets do the trick. I've:
&lt;/p&gt;
&lt;ul&gt;&lt;li&gt;merged Ollie's changes into default and metastable branches.
&lt;/li&gt;&lt;li&gt;updated ckan.net to latest metastable and reindexed it.
&lt;/li&gt;&lt;li&gt;ckan.net now searches on latest packages, including sanskrit example.
&lt;/li&gt;&lt;li&gt;test-hmg.ckan.net also updated to latest metastable for testing with UAT.
&lt;/li&gt;&lt;li&gt;ckanhmg is to be updated next week and DGU ticket remains for this.
&lt;/li&gt;&lt;/ul&gt;
      </description>
      <category>Ticket</category>
    </item>
 </channel>
</rss>